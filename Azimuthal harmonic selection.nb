(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     17462,        422]
NotebookOptionsPosition[     16034,        390]
NotebookOutlinePosition[     16428,        406]
CellTagsIndexPosition[     16385,        403]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"ClearAll", "[", "\"\<Global'*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.84313275858574*^9, 3.843132824654607*^9}, {
  3.843132865954043*^9, 3.84313286907762*^9}, {3.843132899409917*^9, 
  3.8431330986585283`*^9}, {3.843133162177744*^9, 3.843133210100047*^9}, {
  3.8431338815848083`*^9, 3.843133951990387*^9}, {3.843134023214469*^9, 
  3.843134025914405*^9}, {3.843217585699761*^9, 3.84321758708504*^9}, {
  3.843218290235977*^9, 3.843218290365024*^9}, {3.843218540708651*^9, 
  3.8432185513486757`*^9}},ExpressionUUID->"66780ef2-0bea-45aa-92bc-\
6de69e65b2b5"],

Cell[BoxData[
 StyleBox[
  RowBox[{"Azimuthal", " ", "Harmonic", " ", "Selection"}], 
  "Subtitle"]], "Input",
 CellChangeTimes->{{3.84313275858574*^9, 3.843132824654607*^9}, {
  3.843132865954043*^9, 3.84313286907762*^9}, {3.843132899409917*^9, 
  3.8431330986585283`*^9}, {3.843133162177744*^9, 3.843133210100047*^9}, {
  3.8431338815848083`*^9, 3.843133951990387*^9}, {3.843134023214469*^9, 
  3.843134025914405*^9}, {3.843217585699761*^9, 3.84321758708504*^9}, {
  3.843218290235977*^9, 3.843218290365024*^9}, {3.843218540708651*^9, 
  3.843218589071021*^9}, {3.845665628500787*^9, 
  3.845665634415098*^9}},ExpressionUUID->"77949d4b-bf2b-4725-9d86-\
40956346fbbb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"calc", "[", 
   RowBox[{"M_", ",", 
    RowBox[{"I\[Phi]", ":", 
     RowBox[{"{", "__", "}"}]}], ",", 
    RowBox[{"maxTries_", ":", "1000"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sim", ",", "find", ",", "\[Phi]", ",", 
      RowBox[{"try", "=", "True"}], ",", 
      RowBox[{"tryI", "=", "1"}], ",", "eqs"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sim", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Nu]", ",", "\[Phi]"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Total", "[", 
          RowBox[{"MapIndexed", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"I\[Phi]n", ",", " ", "n"}], "}"}], ",", 
              RowBox[{"I\[Phi]n", " ", 
               RowBox[{"Sin", "[", 
                RowBox[{
                 RowBox[{"\[Phi]", "[", 
                  RowBox[{"n", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "M", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"2", "\[Nu]"}], "+", "1"}], ")"}]}], "]"}]}]}], 
             "]"}], ",", "\[IndentingNewLine]", "I\[Phi]"}], "]"}], "]"}], "==",
          "0"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"find", "=", 
      RowBox[{"Function", "[", 
       RowBox[{"delta", ",", "\[IndentingNewLine]", 
        RowBox[{"FindRoot", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Evaluate", "[", 
           RowBox[{"eqs", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"sim", "[", 
               RowBox[{"\[Nu]", ",", "\[Phi]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"\[Nu]", ",", "1", ",", 
                RowBox[{"Length", "[", "I\[Phi]", "]"}]}], "}"}]}], "]"}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Evaluate", "@", 
           RowBox[{"MapIndexed", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"init", ",", "n"}], "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"\[Phi]", "[", 
                  RowBox[{"n", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"init", "+", "delta"}], ",", 
                 RowBox[{"0.01", " ", 
                  RowBox[{"Pi", "/", "M"}]}], ",", "  ", 
                 RowBox[{"0.99", " ", 
                  RowBox[{"Pi", "/", "M"}]}]}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Array", "[", 
               RowBox[{
                RowBox[{"#", "&"}], ",", 
                RowBox[{
                 RowBox[{"Length", "[", "I\[Phi]", "]"}], "+", "2"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"\[Pi]", "/", "M"}]}], "}"}]}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"2", ";;", 
                RowBox[{"-", "2"}]}], "]"}], "]"}]}], "]"}]}]}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"TrueQ", "[", "try", "]"}], "&&", 
        RowBox[{
         RowBox[{"tryI", "++"}], "<=", "maxTries"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"try", "=", 
        RowBox[{"Quiet", "@", 
         RowBox[{"Check", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"find", "[", 
            RowBox[{"RandomReal", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "#"}], ",", "#"}], "}"}], "&"}], "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{".5", 
                 RowBox[{"\[Pi]", "/", "M"}]}], ")"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Length", "[", "I\[Phi]", "]"}], "+", "1"}], ")"}]}],
               "]"}], "]"}], "]"}], ",", "\[IndentingNewLine]", "True"}], 
          "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<Sols\>\"", "->", 
        RowBox[{"Replace", "[", 
         RowBox[{"try", ",", " ", 
          RowBox[{"True", "->", "$Failed"}]}], "]"}]}], ",", 
       RowBox[{"\"\<Eqs\>\"", "->", "eqs"}]}], "|>"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8456424202088823`*^9, 3.845642422028343*^9}, {
   3.845642455035425*^9, 3.845642538801662*^9}, {3.845642639477392*^9, 
   3.845642678510559*^9}, {3.845642780084347*^9, 3.845642841875251*^9}, {
   3.8456428770407743`*^9, 3.845642894395259*^9}, {3.845642927425563*^9, 
   3.8456429278648653`*^9}, {3.8456429737521877`*^9, 3.845643072013062*^9}, {
   3.8456431126638927`*^9, 3.845643205952176*^9}, {3.845643254088716*^9, 
   3.8456432852245827`*^9}, {3.8456433162403316`*^9, 3.845643522780088*^9}, {
   3.8456435571437473`*^9, 3.845643585641856*^9}, {3.845643642758685*^9, 
   3.845643651602619*^9}, {3.845643778584918*^9, 3.845643805278325*^9}, {
   3.845643855170919*^9, 3.845643920119779*^9}, {3.845644036028364*^9, 
   3.845644099147134*^9}, {3.845644137125297*^9, 3.845644180720665*^9}, {
   3.845644245867537*^9, 3.845644248970605*^9}, {3.845644404972623*^9, 
   3.8456444373774643`*^9}, {3.845644762659774*^9, 3.845644763450512*^9}, {
   3.8456448084823923`*^9, 3.845644808768628*^9}, {3.845644841937924*^9, 
   3.845644866395503*^9}, {3.845656602580435*^9, 3.8456566026419086`*^9}, {
   3.845656716032647*^9, 3.84565673597486*^9}, {3.845656890155521*^9, 
   3.845656893307324*^9}, {3.845656973016821*^9, 3.845657100087213*^9}, {
   3.845657200987994*^9, 3.845657201362143*^9}, {3.845657246176875*^9, 
   3.845657250557065*^9}, {3.845657385638294*^9, 3.845657432429682*^9}, {
   3.845657472477625*^9, 3.845657485923894*^9}, {3.845657539796195*^9, 
   3.845657564773407*^9}, {3.84565774171495*^9, 3.845657846155591*^9}, {
   3.845657913924445*^9, 3.8456579295510283`*^9}, {3.8456579608378143`*^9, 
   3.845657993202857*^9}, {3.845658141525446*^9, 3.845658172963323*^9}, {
   3.845658205730645*^9, 3.845658373168063*^9}, 3.845658406637857*^9, {
   3.845658508308511*^9, 3.845658533835332*^9}, {3.8456585834655857`*^9, 
   3.8456586003032217`*^9}, {3.8456586508743153`*^9, 3.845658682658286*^9}, 
   3.845658721451919*^9, {3.84565876289083*^9, 3.845658806014737*^9}, {
   3.845658851838903*^9, 3.845658854248056*^9}, {3.8456589059357643`*^9, 
   3.845658910016556*^9}, {3.845658970830989*^9, 3.845658971540987*^9}, {
   3.845659031721467*^9, 3.845659032039624*^9}, {3.845659100195256*^9, 
   3.845659101866384*^9}, 3.845659174667371*^9, {3.845659252980475*^9, 
   3.8456592535387077`*^9}, {3.845659287288375*^9, 3.845659291778867*^9}, {
   3.8456593225335283`*^9, 3.845659322932817*^9}, {3.8456593648498383`*^9, 
   3.845659365087799*^9}, {3.845659398348859*^9, 3.845659460795136*^9}, {
   3.845659493119153*^9, 3.8456596190600443`*^9}, {3.8456596559897213`*^9, 
   3.8456597014241123`*^9}, 3.845659818054207*^9, 3.845664437911495*^9},
 CellLabel->
  "In[243]:=",ExpressionUUID->"edd8e7c6-dff0-479c-b1be-5f2cc516cf2f"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"M", "=", "1"}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Desired", " ", "magnetic", " ", "field", " ", "harmonic"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"Is", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], ";", "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"List", " ", "of", " ", "azimuthal", " ", "currents"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"RepeatedTiming", "[", 
   RowBox[{"angles", " ", "=", " ", 
    RowBox[{
     RowBox[{"calc", "[", 
      RowBox[{"M", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "]"}], "[", 
     "\"\<Sols\>\"", "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.845660105868969*^9, 3.845660111005184*^9}, {
  3.84566444364585*^9, 3.8456644454350224`*^9}, {3.845664638146846*^9, 
  3.845664638224538*^9}, {3.845664814131298*^9, 3.845664816370751*^9}, {
  3.845664977011323*^9, 3.845665029422123*^9}, {3.845665252217218*^9, 
  3.845665269481797*^9}, {3.8456654053033543`*^9, 3.8456654083595867`*^9}, {
  3.845665565809029*^9, 3.845665606451126*^9}},
 CellLabel->
  "In[248]:=",ExpressionUUID->"f4a0f8fd-1438-4e99-b948-7bff9b10418b"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.0006989847222222222`2.", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Phi]", "[", "1", "]"}], "\[Rule]", "1.1006647897044688`"}], 
     ",", 
     RowBox[{
      RowBox[{"\[Phi]", "[", "2", "]"}], "\[Rule]", "1.7744827030092354`"}], 
     ",", 
     RowBox[{
      RowBox[{"\[Phi]", "[", "3", "]"}], "\[Rule]", "2.549162274013547`"}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.845664776320052*^9, 3.8456648168985033`*^9, {3.845664923058654*^9, 
   3.8456649322994013`*^9}, {3.845664975525577*^9, 3.8456650298268948`*^9}, {
   3.845665205236911*^9, 3.845665221110175*^9}, {3.84566526749065*^9, 
   3.8456652955083313`*^9}, 3.84566555618721*^9, 3.8456658494267673`*^9},
 CellLabel->
  "Out[248]=",ExpressionUUID->"ec350ece-6756-43d0-9946-0e3fee07c1c9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"test", " ", "=", " ", 
  RowBox[{"angles", "/.", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[Phi]", "[", "3", "]"}], "\[Rule]", "x_"}], ")"}], ":>", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[Phi]", "[", "3", "]"}], "\[Rule]", 
      RowBox[{
       RowBox[{"Pi", "/", "M"}], "-", "x"}]}], ")"}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"For", " ", "I"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "1", ",", "1"}], "}"}], " ", "the", " ", 
        "solution", " ", "at", " ", "\[Phi]", " ", "is", " ", "equivalent", 
        " ", "to", " ", "the", " ", "solution", " ", "at", " ", "Pi"}], " ", 
       "-", " ", "\[Phi]"}]}], " ", "*)"}]}]}]}]], "Input",
 CellChangeTimes->{{3.845664785577506*^9, 3.845664903586752*^9}, {
  3.8456654179132137`*^9, 3.845665467054584*^9}},
 CellLabel->
  "In[249]:=",ExpressionUUID->"dde3f98c-2513-4ca1-9511-4d67e73286e6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Phi]", "[", "1", "]"}], "\[Rule]", "0.5924303795762461`"}], 
   ",", 
   RowBox[{
    RowBox[{"\[Phi]", "[", "2", "]"}], "\[Rule]", "1.367109950580558`"}], ",", 
   RowBox[{
    RowBox[{"\[Phi]", "[", "3", "]"}], "\[Rule]", "1.1006647897044681`"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.8456648932362013`*^9, 3.845664904315276*^9}, {
   3.8456649734662323`*^9, 3.8456650312841597`*^9}, {3.845665206586001*^9, 
   3.84566522238351*^9}, 3.845665413431284*^9, 3.845665559587079*^9, 
   3.845665852248782*^9},
 CellLabel->
  "Out[249]=",ExpressionUUID->"6854ad9f-0c23-45c5-8b45-f5c1c1ac412d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"equations", " ", "=", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"calc", "[", 
     RowBox[{"M", ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1", ",", "1"}], "}"}]}], "]"}], "[", "\"\<Eqs\>\"", 
    "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.84566012891599*^9, 3.845660129651335*^9}, {
  3.845664486968821*^9, 3.845664490457843*^9}, {3.845664652887477*^9, 
  3.84566465830033*^9}, {3.845664924669093*^9, 3.845664961568489*^9}, {
  3.8456650151831913`*^9, 3.8456650236446466`*^9}, {3.845665203188216*^9, 
  3.845665213249343*^9}},
 CellLabel->
  "In[250]:=",ExpressionUUID->"d3af6932-e057-4e61-929a-40914ddeef8d"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"Sin", "[", 
     RowBox[{"3", " ", 
      RowBox[{"\[Phi]", "[", "1", "]"}]}], "]"}], "+", 
    RowBox[{"Sin", "[", 
     RowBox[{"3", " ", 
      RowBox[{"\[Phi]", "[", "2", "]"}]}], "]"}], "+", 
    RowBox[{"Sin", "[", 
     RowBox[{"3", " ", 
      RowBox[{"\[Phi]", "[", "3", "]"}]}], "]"}]}], ",", 
   RowBox[{
    RowBox[{"Sin", "[", 
     RowBox[{"5", " ", 
      RowBox[{"\[Phi]", "[", "1", "]"}]}], "]"}], "+", 
    RowBox[{"Sin", "[", 
     RowBox[{"5", " ", 
      RowBox[{"\[Phi]", "[", "2", "]"}]}], "]"}], "+", 
    RowBox[{"Sin", "[", 
     RowBox[{"5", " ", 
      RowBox[{"\[Phi]", "[", "3", "]"}]}], "]"}]}], ",", 
   RowBox[{
    RowBox[{"Sin", "[", 
     RowBox[{"7", " ", 
      RowBox[{"\[Phi]", "[", "1", "]"}]}], "]"}], "+", 
    RowBox[{"Sin", "[", 
     RowBox[{"7", " ", 
      RowBox[{"\[Phi]", "[", "2", "]"}]}], "]"}], "+", 
    RowBox[{"Sin", "[", 
     RowBox[{"7", " ", 
      RowBox[{"\[Phi]", "[", "3", "]"}]}], "]"}]}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.845660131575282*^9, {3.845664428212339*^9, 3.845664492109289*^9}, 
   3.845664564219618*^9, {3.845664645360421*^9, 3.8456646619326353`*^9}, 
   3.845664704379509*^9, {3.8456649428879623`*^9, 3.845665032460464*^9}, {
   3.845665208101001*^9, 3.8456652138108883`*^9}, 3.845665854156452*^9},
 CellLabel->
  "Out[250]=",ExpressionUUID->"68aeb029-c78f-4c83-a742-a76ef8c3d18f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"equations", " ", "/.", " ", "test", " "}]], "Input",
 CellChangeTimes->{{3.8456649453169518`*^9, 3.845664968212974*^9}, {
  3.845665012646722*^9, 3.845665013412784*^9}},
 CellLabel->
  "In[251]:=",ExpressionUUID->"aea5d992-ab11-45ff-b088-a876c620b50c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"9.71445146547012`*^-16", ",", 
   RowBox[{"-", "1.1102230246251565`*^-16"}], ",", 
   RowBox[{"-", "7.771561172376096`*^-16"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8456649686301413`*^9, 3.8456649832519283`*^9}, {
   3.8456650253771973`*^9, 3.845665033672714*^9}, {3.845665209286244*^9, 
   3.84566521588456*^9}, 3.845665856753356*^9},
 CellLabel->
  "Out[251]=",ExpressionUUID->"9c2b36e8-aade-4f94-ae72-7442163eeb06"]
}, Open  ]]
},
WindowSize->{808, 738},
WindowMargins->{{267, Automatic}, {Automatic, 42}},
FrontEndVersion->"12.1 for Mac OS X x86 (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"53d2ec9d-68e9-4e26-a8ba-d19e019f245a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 588, 9, 30, "Input",ExpressionUUID->"66780ef2-0bea-45aa-92bc-6de69e65b2b5"],
Cell[1149, 31, 669, 12, 44, "Input",ExpressionUUID->"77949d4b-bf2b-4725-9d86-40956346fbbb"],
Cell[1821, 45, 7508, 157, 472, "Input",ExpressionUUID->"edd8e7c6-dff0-479c-b1be-5f2cc516cf2f"],
Cell[CellGroupData[{
Cell[9354, 206, 1197, 27, 73, "Input",ExpressionUUID->"f4a0f8fd-1438-4e99-b948-7bff9b10418b"],
Cell[10554, 235, 830, 20, 34, "Output",ExpressionUUID->"ec350ece-6756-43d0-9946-0e3fee07c1c9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11421, 260, 970, 25, 73, "Input",ExpressionUUID->"dde3f98c-2513-4ca1-9511-4d67e73286e6"],
Cell[12394, 287, 662, 16, 34, "Output",ExpressionUUID->"6854ad9f-0c23-45c5-8b45-f5c1c1ac412d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[13093, 308, 707, 17, 30, "Input",ExpressionUUID->"d3af6932-e057-4e61-929a-40914ddeef8d"],
Cell[13803, 327, 1436, 39, 56, "Output",ExpressionUUID->"68aeb029-c78f-4c83-a742-a76ef8c3d18f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[15276, 371, 276, 5, 30, "Input",ExpressionUUID->"aea5d992-ab11-45ff-b088-a876c620b50c"],
Cell[15555, 378, 463, 9, 60, "Output",ExpressionUUID->"9c2b36e8-aade-4f94-ae72-7442163eeb06"]
}, Open  ]]
}
]
*)

